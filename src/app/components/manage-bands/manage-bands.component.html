<ng-container *ngIf="!loading(); else suspenseTemplate">
  <span id="user">
    Bienvenido(a), {{userRoleObject.nickname}}
    <button mat-mini-fab class="profile-btn" matTooltip="Mi perfil"
      [routerLink]="['/dashboard/usuarios/usuario', {'nombre-de-usuario': userRoleObject.nickname}]">
      <mat-icon>person</mat-icon>
    </button>
  </span>
  <div id="bandsSectionContainer">
    <mat-card class="card" appearance="outlined">
      <mat-card-header>
        <mat-card-title class="path-title">Gestión Bandas</mat-card-title>
      </mat-card-header>
      @if (userRoleObject.role.toString()!=='ROLE_ADMIN') {
      <mat-card-content>
        <p>Realiza una acción respecto a tus bandas guardadas o donde participas.
          Puedes consultar, listar, crear, ver estadísticas de tus bandas y/o
          agregar músicos invitados.</p>
      </mat-card-content>
      <mat-card-footer>
        <div>
          <button routerLink="/dashboard" mat-button>Regresar al menú</button>
          <button routerLink="/" mat-button>Ir al Home</button>
        </div>
      </mat-card-footer>
      } @else {
      <p>Como administrador puedes obtener el listado de todas las bandas registradas en Bandlogs-Manager</p>
      }
    </mat-card>
    <app-logged-in-user-menu section="bands" (menuItemEmitter)="handleMenuItem($event)">
    </app-logged-in-user-menu>
    @if(allBands.length >= 1) {
    <p id="longText">{{longText}}</p>
    <button routerLink="dashboard/bandas/crear" mat-mini-fab id="addBandBtn" matTooltip="Agregar banda" (click)="openFormDialog(getManagingBandEnumType().TO_CREATE, {
            loggedInUsername: userRoleObject.nickname,
            loading,
            cookieService
        })">
      <mat-icon>add</mat-icon>
    </button>
    <div id="tableContainer">
      <table mat-table [dataSource]="dataSource">
        <!-- Name Column -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef> Nombre </th>
          <td mat-cell *matCellDef="let element"> {{element.name}} </td>
        </ng-container>

        <!-- Name Column -->
        <ng-container matColumnDef="director">
          <th mat-header-cell *matHeaderCellDef> Director </th>
          <td mat-cell *matCellDef="let element">
            <a [routerLink]="['/dashboard/usuarios/usuario', {'nombre-de-usuario': element.director}]"
              class="user-link">
              {{element.director}}
            </a>
          </td>
        </ng-container>

        <!-- Name Column -->
        <ng-container matColumnDef="musicalGenre">
          <th mat-header-cell *matHeaderCellDef> Género musical </th>
          <td mat-cell *matCellDef="let element"> {{element.musicalGenre.toString()}} </td>
        </ng-container>

        <!-- Name Column -->
        <ng-container matColumnDef="action">
          <th mat-header-cell *matHeaderCellDef> Acción </th>
          <td mat-cell *matCellDef="let element">
            @if (userRoleObject.role.toString()==='ROLE_ADMIN') {
            <button class="band-delete" (click)="openFormDialog(
                    getManagingBandEnumType().TO_DELETE, {
                      band: element
                    })
                  " mat-icon-button>
              <mat-icon>delete</mat-icon>
            </button>
            } @else {
            @if (element.director===userRoleObject.nickname) {
            <button class="band-update" (click)="openFormDialog(
                      getManagingBandEnumType().TO_UPDATE, {
                        band: element
                      })
                    " mat-icon-button>
              <mat-icon>edit</mat-icon>
            </button>
            <button class="band-delete" (click)="openFormDialog(
                      getManagingBandEnumType().TO_DELETE, {
                        band: element
                      })
                    " mat-icon-button>
              <mat-icon>delete</mat-icon>
            </button>
            
            }
            }
            <button [routerLink]="'/dashboard/bandas/'.concat(element.bandId)" mat-stroked-button>
              DETALLES
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
    </div>
    } @else {
    <p class="result-msg">0 Resultado(s) de tus bandas asociadas</p>
    }
    @if(userRoleObject.role.toString()!=='ROLE_ADMIN') {
    <mat-card class="card" appearance="outlined">
      <mat-card-header>
        <mat-card-title>Agrega un músico a bandas que diriges donde todavía no es un miembro</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div id="userFormFieldContainer">
          <mat-form-field class="user-form-field">
            <mat-label>nombre de usuario</mat-label>
            <input
              #filterInput
              type="text"
              [matAutocomplete]="auto"
              (focus)="onFilterUsersInputFocus()"
              (input)="filterUsers()"
              [formControl]="userNicknameControl"
              matInput
             />
            <mat-autocomplete requireSelection #auto="matAutocomplete" id="userAutocomplete">
              @for (user of filteredUsers(); track user.userId) {
              <mat-option [value]="user.nickname" class="user-option" [matTooltip]="user.nickname">
                {{user.nickname}}
                <span class="user-fullname">{{user.firstname}} {{user.lastname}}</span>
              </mat-option>
              }
            </mat-autocomplete>
            <mat-error
              *ngIf="
                userNicknameControl.invalid 
                && userNicknameControl.hasError('required') 
                && userNicknameControl.touched
              "
            >
              El campo es obligatorio
            </mat-error>
          </mat-form-field>
          <button type="button" id="search" [disabled]="userNicknameControl.invalid" (click)="openFormDialog(
              getManagingBandEnumType().TO_ADD_MEMBER_TO_BAND, {
                bands: allBands,
                userNickname: userNicknameControl.value
              })
            " mat-mini-fab>
            <mat-icon>add</mat-icon>
          </button>
        </div>
      </mat-card-content>
      <mat-card-footer class="card-footer">
        <div>
          <button routerLink="/dashboard" mat-button>Regresar al menú</button>
          <button routerLink="/" mat-button>Ir al Home</button>
        </div>
      </mat-card-footer>
    </mat-card>
    }
  </div>
</ng-container>
<!-- Loading bands state template when loading signal value changes  -->
<ng-template #suspenseTemplate>
  <app-form-suspense text="Cargando bandas..." id="suspense"></app-form-suspense>
</ng-template>