<div class="band-container">
    <nav class="side-menu">
        <mat-list class="side-menu-list">
            <mat-list-item>
                <button
                    matTooltip="agregar nuevo miembro"
                    mat-raised-button
                    [disabled]="band().director!==userRoleObject.nickname"
                >
                    <mat-icon class="menu-item-icon">person_add</mat-icon>
                </button>
            </mat-list-item>
            <mat-list-item>
                <button mat-raised-button [routerLink]="
                        '/dashboard/bandas/'+band().bandId+'/eventos/agregar'
                    "
                    [matTooltip]="'agregar nuevo evento para la banda'"
                    [disabled]="band().director!==userRoleObject.nickname"
                >
                    <mat-icon class="menu-item-icon">insert_invitation</mat-icon>
                </button>
            </mat-list-item>
            <mat-list-item>
                <button matTooltip="Descarga PDF información de Banda" mat-raised-button><mat-icon
                        class="menu-item-icon">save_alt</mat-icon></button>
            </mat-list-item>
            <mat-list-item>
                <button (click)="openFormDialog(getManagingBandEnumType().TO_DELETE)"
                    matTooltip="eliminar banda" mat-raised-button [disabled]="band().director!==userRoleObject.nickname">
                    <mat-icon class="menu-item-icon">delete_forever</mat-icon>
                </button>
            </mat-list-item>
            <mat-list-item>
                <button routerLink="/dashboard" matTooltip="Volver al menú" mat-raised-button><mat-icon
                        class="menu-item-icon">menu</mat-icon></button>
            </mat-list-item>
            <mat-list-item>
                <button routerLink="/" matTooltip="Ir al Home" mat-raised-button><mat-icon
                        class="menu-item-icon">home</mat-icon></button>
            </mat-list-item>
        </mat-list>
    </nav>
    <div>
        <div [class]="getTheme()==='dark'?'text-white': 'text-dark'" id="content">
            <div id="head">
                <h6>{{band().name}}</h6>
                @if (band().director===userRoleObject.nickname) {
                <button
                    matTooltip="editar banda"
                    (click)="openFormDialog(
                            getManagingBandEnumType().TO_UPDATE,
                            {band: band()}
                        )
                    " mat-icon-button
                >
                    <mat-icon id="editIcon">edit</mat-icon>
                </button>
                }
            </div>
            <p>Director: {{band().director}}</p>
            <p>Género: {{getMusicalGenreString()}}</p>
            @if(band().users!==undefined) {
            <div>
                <p>Miembros de la banda:</p>
                <table mat-table [dataSource]="band().users!" class="mat-elevation-z8">
                    <!-- Band member lastname Column -->
                    <ng-container matColumnDef="lastname">
                        <th mat-header-cell *matHeaderCellDef> Apellidos </th>
                        <td mat-cell *matCellDef="let element"> {{element.lastname}} </td>
                    </ng-container>

                    <!-- Band member firstname Column -->
                    <ng-container matColumnDef="firstname">
                        <th mat-header-cell *matHeaderCellDef> Nombre(s) </th>
                        <td mat-cell *matCellDef="let element"> {{element.firstname}} </td>
                    </ng-container>

                    <!-- Band member username Column -->
                    <ng-container matColumnDef="nickname">
                        <th mat-header-cell *matHeaderCellDef> Usuario/Apodo </th>
                        <td mat-cell *matCellDef="let element">
                            <a [routerLink]="
                                    ['/dashboard/usuarios/usuario', {
                                            'nombre-de-usuario': element.nickname
                                        }
                                    ]
                                "
                                class="user-link"
                            >
                                {{element.nickname}}
                            </a>
                        </td>
                    </ng-container>

                    <!-- Phone Number Column -->
                    <ng-container matColumnDef="phoneNumber">
                        <th mat-header-cell *matHeaderCellDef> Tel. móvil </th>
                        <td mat-cell *matCellDef="let element"> {{element.phoneNumber}} </td>
                    </ng-container>

                    <!-- Symbol Column -->
                    <ng-container matColumnDef="action">
                        <th mat-header-cell *matHeaderCellDef> Acción </th>
                        <td mat-cell *matCellDef="let element">
                            @if (band().director===userRoleObject.nickname && element.nickname!==band().director) {
                            <button mat-icon-button
                                [matTooltip]="'Retirar a '.concat(element.firstname+' de la banda') "
                                (click)="cancelMemberUser(band(), element)"><mat-icon>cancel</mat-icon></button>
                            }
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="memberUserColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: memberUserColumns;"></tr>
                </table>
            </div>
            }
            @if (band().events!==undefined && (band().events?.length!)>0) {
            <div class="list">
                <p>Eventos de la banda:</p>
                <table mat-table [dataSource]="band().events!" class="mat-elevation-z8">
                    <!-- Event date Column -->
                    <ng-container matColumnDef="date">
                        <th mat-header-cell *matHeaderCellDef> Fecha </th>
                        <td mat-cell *matCellDef="let element"> {{element.date}} </td>
                    </ng-container>

                    <!-- Event description firstname Column -->
                    <ng-container matColumnDef="description">
                        <th mat-header-cell *matHeaderCellDef> Descripción </th>
                        <td mat-cell *matCellDef="let element"> {{element.description}} </td>
                    </ng-container>

                    <!-- Band member username Column -->
                    <ng-container matColumnDef="location">
                        <th mat-header-cell *matHeaderCellDef> Lugar/Dirección </th>
                        <td mat-cell *matCellDef="let element"> 
                            {{element.location ?? ''}} 
                        </td>
                    </ng-container>

                    <!-- Symbol Column -->
                    <ng-container matColumnDef="action">
                        <th mat-header-cell *matHeaderCellDef> Acción </th>
                        <td mat-cell *matCellDef="let element" class="actions">
                            <button
                                mat-stroked-button
                                [routerLink]="'/dashboard/bandas/'+band().bandId+'/eventos/'.concat(element.eventId)"
                            >
                                DETALLES
                            </button>
                            <button
                                mat-icon-button
                                [matTooltip]="'Eliminar evento: '.concat(element.description+' de la banda')"
                                (click)="openFormDialog(getManagingBandEnumType().TO_DELETE_EVENT_OF_BAND, {event: element})"
                            >
                                <mat-icon>delete_forever</mat-icon>
                            </button>
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="eventsColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: eventsColumns;"></tr>
                </table>
            </div>
            }
            @else {
            <p>No hay eventos asociados a esta banda.</p>}
        </div>
    </div>
</div>